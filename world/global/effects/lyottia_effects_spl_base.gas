[effect_script*]  // original RS modified MM maintaining ET
{
	name	=starburst_base;  // This script supports three spells (1 == fireshot) (2 == firespray) (3 == firestorm)

	script	=[[
			///////////////////////////////////////////////////
			// create the trackball to base the whole effect on
			sfx create trackball #TARGET_KB 
				"must_update()color0(0,0,1)ts(2.5)scale(.7)dur(4)";
			set $trackball #POP;

            sfx create lightsource #SOURCE 
				"must_update()color0(0,0,1)tin(0)";
			set $blue_light #POP;

			sfx create flurry #SOURCE 
				"must_update()count(10)dur(2)ts(9)tin(0)tout(0)radius(.3)
				color0(.5,.5,1)";
			set $sparkles #POP;

			sfx rat $blue_light;
			sfx rat $sparkles;

			sfx target $blue_light $trackball;
			sfx target $sparkles $trackball;
			sfx attach $trackball $blue_light;
			sfx attach $trackball $sparkles;

			/////////////////////////////////////////////////
			// if we are using the firestorm spell we want the shots to come from the heavens.
			if ( [1] != 3 )
			{
				sfx position_at $trackball @weapon_bone source;
			}
			else
			{
				sound play s_e_spell_fire_rain_cast at #SOURCE_POSITION dist 1 40;
				sfx position_at $trackball @kill_bone source;
			} // ( [1] != 3 )


			///////////////////////////////////////////
			// this adds some variance to where the trackball is aiming
			sfx offset_bone $trackball [0] target;
			sfx freeze_targets $trackball;

			//////////////////////////////////
			// you can pick your friends and you can pick your nose, but you
			// don't want to hit the in the back of the head with a fireball
			sfx friendly party $trackball;

			sfx start $trackball;
			
			sfx attach $trackball $fire2;

			waitfor collision $trackball #DEFAULT_TIMEOUT;
			set $collision_type #POP;

			if ( ( $collision_type == #OBJECT_COLLISION ) || ( $collision_type == #TERRAIN_COLLISION ) )
			{
				if ([1] == 1)
				{
					get target_position $trackball target;
					sound play s_e_spell_energy_ball_hit at #POP dist 3 30;
				}

				if ([1] == 2)
				{
					get target_position $trackball target;
					sound play s_e_spell_energy_ball_hit at #POP dist 3 30;
				}

				if ([1] == 3)
				{
					get target_position $trackball target;
					sound play s_e_spell_energy_ball_hit at #POP dist 3 30;
				}
			}


			if ( $collision_type == #OBJECT_COLLISION )
			{
				get target_position $trackball target;
				sound play s_e_spell_energy_ball_hit at #POP;

				get collision target $trackball target;
				sfx create flurry #TARGET_KB 
					"must_update()count(30)dur(.4)ts(.1)tin(0)tout(0)radius(1.5)
					color0(.2,.2,1)grow_params(1,.8,0)";
				sfx start #POP;

				sfx create cylinder #TARGET_KB
					"must_update()texture(b_sfx_blueflare_01)hp0(0,0,0)hp1(1,1,0)
					spin(12)rp0(0,1,1)rp1(0,3,3)dur(1)scale(.75)color0(.2,.2,1)
					offset(0,-.5,0)";
				sfx start #POP;
				
				sfx create cylinder #TARGET_KB
					"must_update()texture(b_sfx_blueflare_01)hp0(1,1,0)hp1(0,0,0)
					spin(-12)rp0(0,1,1)rp1(0,3,3)dur(1)scale(.75)color0(.2,.2,1)
					offset(0,-.5,0)";
				sfx start #POP;

				pause .2;

				sfx create cylinder #TARGET_KB
					"must_update()texture(b_sfx_blueflare_01)hp0(0,0,0)hp1(1,1,0)
					spin(12)rp0(0,1,1)rp1(0,3,3)dur(1)scale(.75)color0(.4,.4,1)
					offset(0,-.5,0)";
				sfx start #POP;
				
					
				sfx create cylinder #TARGET_KB
					"must_update()texture(b_sfx_blueflare_01)hp0(1,1,0)hp1(0,0,0)
					spin(-12)rp0(0,1,1)rp1(0,3,3)dur(1)scale(.75)color0(.4,.4,1)
					offset(0,-.5,0)";
				sfx start #POP;

				pause .2;

               	sfx create explosion #TARGET_KB 
	               	"must_update()texture(b_sfx_sparkle01)omni_dir()dur(1)
	               	color0(.4,.4,1)scale(1.2)count(10)";
				sfx start #POP;

				sfx create explosion #TARGET_KB 
					"must_update()texture(b_sfx_sparkle01)offset(0,.1,0)
					omni_dir()dur(1)color0(.8,.8,1)scale(1.2)count(10)";
				sfx start #POP;
			}


			if ( $collision_type == #TERRAIN_COLLISION )
			{
                get collision point $trackball;
				sfx create explosion #POP 
					"must_update()color0(.2,.2,1)scale(.6)count(16)";
				set $exp1 #POP;
				get collision point $trackball;
				sfx create explosion #POP 
					"must_update()color0(1,1,1)scale(.6)count(16)";
				set $exp2 #POP;

				//get collision point $trackball
				//sound play s_e_spell_energy_ball_hit at #POP dist 1 15

				get collision direction $trackball;
				sfx direction $exp1 #PEEK;
				sfx direction $exp2 #PEEK;

				sfx start $exp1;
				sfx start $exp2;
			}

			///////////////////////////////////
			// clean up.

			worldmsg WE_SPELL_SYNC_END #OWNER_GOID #OWNER_GOID #TARGET_GOID;
			]];
}
[effect_script*] // - ET
{
	name	=lyottia_effect_catapulted_summon;

	script	=[[
			///////////////////////////////////////
			// all we do is call the base firebomb
			call lyottia_effect_catapulted_summon_base v<0 0 0> [0];
			waitfor script #POP #DEFAULT_TIMEOUT;
			worldmsg WE_SPELL_SYNC_END #OWNER_GOID #OWNER_GOID #TARGET_GOID;
			]];
}
[effect_script*] // - ET
{
	name	=lyottia_effect_catapulted_summon_base;

	script	=[[
	
			sfx create orbiter #TARGET_KB 
				"radius(0)dur(10)invisible()";
			sfx snap_to_ground #PEEK;              
			set $orb #PEEK;
			sfx start #POP;  
			
			pause .01;                                     
	        
			/////////////////////////////////////////
			// This is the main trackball for the effect, everything is based off of this.
			sfx create trackball #TARGET_KB 
				"invisible()must_update()dir(0,1,0)dur(#DEFAULT_TIMEOUT)afterlife(2)scale(.45)
				ts(1.4)homing()damped()kdamp(0)accel(1)";
			sfx rat #PEEK;
			sfx target #PEEK $orb;
			set $trackball #POP;
			sfx position_at $trackball @weapon_bone source;
			sfx offset_bone $trackball [0] target;
//			sfx freeze_targets $trackball;
			sfx friendly party $trackball;
			sfx start $trackball;

			sfx create orbiter #TARGET 
				"must_update()scale(1)radius(0)theta(0)iphi(0)
				itheta(0)model([1])";
			set $projectile #POP;
			sfx rat $projectile;
			sfx target $projectile $trackball;
			sfx start $projectile;
			
			pause .01;                                     
	        
			sound play s_e_FBfireball_launch at #SOURCE_POSITION dist 3 20;
			waitfor collision $trackball #DEFAULT_TIMEOUT;
			
			set $collision_type #POP;
			if ( ( $collision_type == #OBJECT_COLLISION ) || ( $collision_type == #TERRAIN_COLLISION ) )
			{
				get target_position $trackball target;
				sound play s_e_FBfireball_hit at #POP dist 3 20;
				
				////////////////////////////
				// clean up
				sfx destroy $trackball;
			}
			
			worldmsg WE_SPELL_SYNC_END #INVALID_GOID #OWNER_GOID #TARGET_GOID;
						
			]];
}
[effect_script*] // -ET
{
	name	=fire_cyclone_base;

	script =[[
			set $height1 2;
			set $height2 4;
			set $height3 6;

			set $radius1 [3];
			set $radius2 [4];
			set $speed 20;

			set $fade .65;

			set $size 5;

			sound play s_e_burning_large at #TARGET_POSITION dist 30 40 loop;
			set $burning #POP;

			//frandrange .2 .3
			sfx create orbiter #TARGET 
				"must_update()invisible()iphi(0)radius($radius1)iphi(.6)
				free()smooth()";
			set $base #POP;
			sfx snap_to_ground $base;
			sfx start $base;

			//frandrange -.6 -.9
			sfx create orbiter #TARGET 
				"must_update()invisible()iphi(0)radius($radius1)iphi(-1.8)
				free()smooth()";
			set $orb #POP;
			sfx rat $orb;
			sfx target $orb $base;
			sfx start $orb;

			sfx create fire #TARGET 
				"must_update()offset(0,-.5,0)count(120)radius($radius2)
				color0(1,.6,.3)color1(0,0,0)alphafade($fade)flamesize($size)
				max_radius(2)velocity(0,-50,0)accel(0,50,0)min_displace(2)
				max_displace(4)";
			set $fire1 #POP;
			sfx rat $fire1;
			sfx target $fire1 $orb;
			sfx start $fire1;

			sfx create fire #TARGET 
				"must_update()offset(0,2,0)count(120)radius($radius2)
				color0(1,.4,.1)color1(0,0,0)alphafade($fade)flamesize($size)
				max_radius(2)velocity(0,50,0)accel(0,-50,0)min_displace(-2)
				max_displace(6)[0]";
			set $fire2 #POP;
			sfx rat $fire2;
			sfx target $fire2 $orb;
			sfx start $fire2;

			pause [2];

			sfx finish $fire1;
			sfx finish $fire2;
			sound stop $burning;

			pause 2;

			sfx destroy $base;
			sfx destroy $orb;

			worldmsg WE_SPELL_SYNC_END #OWNER_GOID #OWNER_GOID #TARGET_GOID;

		]];
}